<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="icon" href="/favicon.ico" type="image/x-icon"/><title>TypeScript&#x27;s type-system as a runtime<!-- --> - Blog - Akshay Nair</title><meta name="description" content="Interrogation of the guy who allegedly turned typescripts type-system into it&#x27;s own purely functional programming language"/><meta name="next-head-count" content="6"/><link rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/103f6172f9496d3d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/103f6172f9496d3d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/64930e3055f5cdfd.css" as="style"/><link rel="stylesheet" href="/_next/static/css/64930e3055f5cdfd.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8344679a38250489.js" defer=""></script><script src="/_next/static/chunks/framework-6564377a49303cf2.js" defer=""></script><script src="/_next/static/chunks/main-09d1f590d0066570.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8af340429d7c0297.js" defer=""></script><script src="/_next/static/chunks/660-39c229660589c9c2.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-748333d840764e96.js" defer=""></script><script src="/_next/static/OS3xMTDMcxtkWoRrNFNqv/_buildManifest.js" defer=""></script><script src="/_next/static/OS3xMTDMcxtkWoRrNFNqv/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="__className_ad7b13"><header class="layout_header__H1FPN !pt-4 !pb-8"><span class="layout_bubble__VpDJP"></span><div class=" relative text-right flex px-6 justify-around gap-3 text-base align-top inline-block text-sm max-w-[800px] m-auto" style="margin-top:0.8rem"><div class="pt-1"><a class="layout_navLink__eokNB " href="/">Projects</a></div><div class="pt-1"><a class="layout_navLink__eokNB " href="/about">About</a></div><div class="pt-1"><a class="layout_navLink__eokNB " href="/blog">Blog</a><span class="absolute text-slate-600 ml-1 mt-0.5 w-full text-left max-md:hidden">/<svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="circle-dot" class="svg-inline--fa fa-circle-dot fa-xs ml-1" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256-96a96 96 0 1 1 0 192 96 96 0 1 1 0-192z"></path></svg></span></div><div class="pt-1"><a class="layout_navLink__eokNB " href="https://desmos.ediblemonad.dev">Desmos</a></div><div class="pt-1"><a class="layout_navLink__eokNB " href="/contact">Links</a></div></div></header><main class="page_main__LgpvM"><article class="prose prose-invert max-w-full"><h1 class="text-accent-1">TypeScript&#x27;s type-system as a runtime</h1><!--$?--><template id="B:0"></template><!--/$--><hr/></article><div class="[&amp;&gt;.utterances]:max-w-none py-6 px-3"></div></main></div></div><div hidden id="S:0"><blockquote>
<p>Disclaimer: The following content is not very informative</p>
</blockquote>
<p>Where were you on the night of 20th January? ANSWER ME, YOU FUCK!
Not a talker, yeah? No problem. You&#x27;ll talk eventually. They all do.</p>
<p>We have an overwhelming amount of evidence that suggests that you were the one responsible for turning typescript&#x27;s type system into it&#x27;s own purely functional programming language.
What kind of a sick, twisted man, does that?
You&#x27;re gonna be spending a lot of time behind bars for this.</p>
<p>The reports suggest that you can even read/write files, perform basic io and even interop with js from it?</p>
<p>Take a look at some of the crime scene photos.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> main = [
  <span class="hljs-title class_">PutStringLn</span>&lt;<span class="hljs-string">&#x27;Greetotron 6000 initializing...&#x27;</span>&gt;,

  <span class="hljs-title class_">PutString</span>&lt;<span class="hljs-string">&#x27;Your name? &#x27;</span>&gt;,
  <span class="hljs-title class_">Bind</span>&lt;<span class="hljs-title class_">ReadLine</span>, &lt;name <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt;<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">PutStringLn</span>&lt;<span class="hljs-string">`Hello, <span class="hljs-subst">${name}</span>`</span>&gt;&gt;,

  <span class="hljs-title class_">PutString</span>&lt;<span class="hljs-string">&#x27;Your purpose in life? &#x27;</span>&gt;,
  <span class="hljs-title class_">Bind</span>&lt;<span class="hljs-title class_">ReadLine</span>, <span class="hljs-title class_">HandleResponse</span>&gt;,

  <span class="hljs-title class_">PutStringLn</span>&lt;<span class="hljs-string">&#x27;Bye bye&#x27;</span>&gt;,
]

<span class="hljs-comment">// Equivalent to `HandleResponse :: string -&gt; Effect ()`</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HandleResponse</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Kind1</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Effect</span>&gt; {
  <span class="hljs-attr">return</span>: <span class="hljs-title class_">Do</span>&lt;[
    <span class="hljs-title class_">PutStringLn</span>&lt;<span class="hljs-string">`Interesting that you believe &quot;<span class="hljs-subst">${<span class="hljs-variable language_">this</span>[<span class="hljs-string">&#x27;input&#x27;</span>]}</span>&quot; is your purpose. Hmmmm...`</span>&gt;,
    <span class="hljs-title class_">PutStringLn</span>&lt;<span class="hljs-string">&#x27;Judging harshly...&#x27;</span>&gt;,
    <span class="hljs-title class_">PutStringLn</span>&lt;<span class="hljs-string">&#x27;Saving response...&#x27;</span>&gt;,
    <span class="hljs-title class_">WriteFile</span>&lt;<span class="hljs-string">&#x27;./response.txt&#x27;</span>, <span class="hljs-variable language_">this</span>[<span class="hljs-string">&#x27;input&#x27;</span>]&gt;,
  ]&gt;
}
</code></pre>
<p>Do you feel any remorse for the victims you&#x27;ve affected? I hope you get the chair for this.</p>
<p>We also found the murder weapon on the crime scene - <code>npx tsr run ./somefile.ts</code>.
Not just that, it says here you built the weapon yourself using <code>ts-morph</code> as a wrapper around the typescript compiler.
Did you use the source file as your runtime representation of memory, you piece of shit?!
But, we&#x27;re getting a bit ahead of ourselves here.</p>
<p>Let&#x27;s get to the motive which is the only piece of the puzzle we&#x27;re missing.
Why would a mediocre software developer suddenly go postal and make something like this?
Did someone pay you to do this? Is that what this is about? Money?
Naah. This was a little more personal than that.
I have a theory for why you did it. And it&#x27;s as simple as it gets.
You&#x27;re a sick man who enjoys watching people cringe and suffer. Is that what this blog post is about? More cringe?</p>
<p>We&#x27;ve even figured out how you smuggled all the results of the io back into the program.
It was a result node, wasn&#x27;t it? A stray object that you injected properties into, you sick fuck.
Was that your runtime representation of memory? You just used the randomly generated property name to access the result in your effects.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">type</span> __$result = {
  <span class="hljs-string">&#x27;90sd9...&#x27;</span>: { <span class="hljs-attr">output</span>: <span class="hljs-string">&#x27;Result of computation&#x27;</span> }
}
</code></pre>
<p>Another thing that&#x27;s been bugging me is,</p>
<h2>Why is the effects api monadic?</h2>
<p>Was it because you wanted all operations on the results represented in the type tree so you could manipulate it?</p>
<p>You disgust me. In my 20 years on the force, I&#x27;ve never met a man as disturbed as you.
Don&#x27;t bother pleading insanity here though. This was calculated. No one is going to buy it.</p>
<h2>Remember your hacky attempts at first class functions?</h2>
<p>We have it in our custody and it&#x27;s talking like a parrot.
Telling us everything we need to know about your sick experiments!</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Greet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Kind1</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; {
  <span class="hljs-attr">return</span>: <span class="hljs-string">`Hello, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>[<span class="hljs-string">&#x27;input&#x27;</span>]}</span>!`</span>
}

<span class="hljs-keyword">type</span> msg = <span class="hljs-title class_">Apply</span>&lt;<span class="hljs-title class_">Greet</span>, <span class="hljs-string">&#x27;EdibleMonad&#x27;</span>&gt; <span class="hljs-comment">// : &#x27;Hello, EdibleMonad!&#x27;</span>
</code></pre>
<p>Yeah, we got you now, you bastard!</p>
<p>You weren&#x27;t satisfied with this tho, were you?
You wanted your first-class functions to be inline. You needed it.
So you made your runtime recognize lambda functions as first-class functions.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">type</span> main = <span class="hljs-title class_">Bind</span>&lt;
  <span class="hljs-title class_">ReadFile</span>&lt;<span class="hljs-string">&#x27;./file.txt&#x27;</span>&gt;,
  &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt;<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">PutStringLn</span>&lt;T&gt;
&gt;
</code></pre>
<p>But this is where you fucked up. You couldn&#x27;t generalize this as a pattern because typescript doesn&#x27;t work like that.
Typescript doesn&#x27;t support higher kinded types, dumbass!
So you settled for only allowing this pattern inside <code>Bind</code> and <code>Try</code>.
You flew too close to the sun, Icarus and it lead us straight to you.</p>
<p>You&#x27;re done, buddy. This case is as good as closed so you might as well confess.</p>
<h2>Alright! Alright! I confess!</h2>
<p>It was me who did it. I made the runtime that turns typescript types into a purely functional programming language!
I did it because I fucking wanted to! And I enjoyed every second of it!</p>
<p>I saw people making things that defied all logic, like an <a href="https://github.com/judehunter/ts-asm">assembly interpreter</a> within the typescript type-system.
I knew if I wanted to make it do something more, I&#x27;ll need a runtime! That&#x27;s when I came up with my master plan.</p>
<p>I don&#x27;t regret a thing! I&#x27;ve made my mark on the world even if that mark is a piss stain on the side of the street.</p>
<hr/>
<blockquote>
<p>Akshay was charged with cringe and sentenced to death by lethal injection. It was later discovered that this wasn&#x27;t all that big of a deal and completely blown out of proportion</p>
</blockquote></div><script>function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("B:0","S:0")</script><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"meta":{"title":"TypeScript's type-system as a runtime","description":"Interrogation of the guy who allegedly turned typescripts type-system into it's own purely functional programming language","published":true,"date":"2023-02-13"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"ts-types-runtime"},"buildId":"OS3xMTDMcxtkWoRrNFNqv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>